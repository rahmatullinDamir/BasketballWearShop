<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>–ü—Ä–æ—Ñ–∏–ª—å | Baller Merch</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <script src="/js/showModalAbout.js"></script>
    <link rel="stylesheet" href="/css/style.css"/>
</head>
<body>
<#include "header.ftlh">

<div class="profile-container">
    <div class="profile-header">
        <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.username}!</p>
    </div>

    <div class="profile-content">
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="profile-section user-info-section">
            <div class="section-header">
                <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <span class="section-icon">üë§</span>
            </div>
            <div class="info-content">
                <div class="info-item">
                    <span class="info-label">–ò–º—è:</span>
                    <span class="info-value">${user.username}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">${user.email}</span>
                </div>
            </div>
        </div>

        <!-- –ê–¥—Ä–µ—Å -->
        <div class="profile-section address-section">
            <div class="section-header">
                <h2>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
                <span class="section-icon">üìç</span>
            </div>
            <div class="address-content">
                <#if !userAddress?has_content>
                    <div class="no-address">
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                        <button class="profile-button" onclick="showWindow()">–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</button>
                    </div>
                <#else>
                    <div class="address-card">
                        <div class="address-details">
                            <div class="address-item">
                                <span class="address-label">–ì–æ—Ä–æ–¥:</span>
                                <span class="address-value">${userAddress.city}</span>
                            </div>
                            <div class="address-item">
                                <span class="address-label">–£–ª–∏—Ü–∞:</span>
                                <span class="address-value">${userAddress.street}</span>
                            </div>
                            <div class="address-item">
                                <span class="address-label">–ò–Ω–¥–µ–∫—Å:</span>
                                <span class="address-value">${userAddress.postalCode}</span>
                            </div>
                            <div class="address-item">
                                <span class="address-label">–°—Ç—Ä–∞–Ω–∞:</span>
                                <span class="address-value">${userAddress.country}</span>
                            </div>
                        </div>
                        <div class="address-actions">
                            <button class="profile-button secondary" onclick="changeAddress(${userAddress.id})">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                            <button class="profile-button danger" onclick="deleteAddress(${userAddress.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </#if>
            </div>
        </div>

        <!-- –ó–Ω–∞—á–∫–∏ -->
        <div class="profile-section badges-section">
            <div class="section-header">
                <h2>–ú–æ–∏ –∑–Ω–∞—á–∫–∏</h2>
                <span class="section-icon">üèÜ</span>
            </div>
            <div class="badges-content">
                <#if user.badges?has_content>
                    <div class="badges-grid">
                        <#list user.badges as badge>
                            <div class="badge-card">
                                <div class="badge-icon">
                                    <img src="http://localhost:8080/files/${badge.iconImageInfo.storageName}" alt="${badge.name}"/>
                                </div>
                                <div class="badge-info">
                                    <h4>${badge.name}</h4>
                                    <p class="badge-description">${badge.description}</p>
                                    <span class="badge-points">–ë–∞–ª–ª–æ–≤: ${badge.requiredPoints}</span>
                                </div>
                            </div>
                        </#list>
                    </div>
                <#else>
                    <div class="no-badges">
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–Ω–∞—á–∫–æ–≤</p>
                        <p class="hint">–°–æ–≤–µ—Ä—à–∞–π—Ç–µ –ø–æ–∫—É–ø–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–∫–∏!</p>
                    </div>
                </#if>
            </div>
        </div>

        <div class="profile-section orders-section">
            <div class="section-header">
                <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
                <span class="section-icon">üì¶</span>
            </div>
            <div class="orders-content">
                <#if orders?? && orders?size gt 0>
                    <div class="orders-list">
                        <#list orders as order>
                            <div class="order-card">
                                <div class="order-header">
                                    <div class="order-info">
                                        <span class="order-number">–ó–∞–∫–∞–∑ #${order.id}</span>
                                        <span class="order-date">${order.createdAt}</span>
                                    </div>
                                    <div class="order-status">
                                        <span class="status-badge">–í—ã–ø–æ–ª–Ω–µ–Ω</span>
                                    </div>
                                </div>
                                <div class="order-items">
                                    <#list order.items as item>
                                        <div class="order-item">
                                            <div class="item-details">
                                                <span class="item-name">${item.productName}</span>
                                                <div class="item-meta">
                                                    <span class="item-size">–†–∞–∑–º–µ—Ä: ${item.size}</span>
                                                    <span class="item-quantity">√ó${item.quantity}</span>
                                                </div>
                                            </div>
                                            <span class="item-price">${item.price} ‚ÇΩ</span>
                                        </div>
                                    </#list>
                                </div>
                                <div class="order-footer">
                                    <div class="order-summary">
                                        <#if order.discount gt 0>
                                            <div class="discount-info">
                                                <span class="discount-label">–°–∫–∏–¥–∫–∞:</span>
                                                <span class="discount-value">-${order.discount}%</span>
                                            </div>
                                        </#if>
                                        <div class="total-info">
                                            <span class="total-label">–ò—Ç–æ–≥–æ:</span>
                                            <span class="total-value">${order.total} ‚ÇΩ</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </#list>
                    </div>
                <#else>
                    <div class="no-orders">
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                        <a href="/" class="profile-button">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
                    </div>
                </#if>
            </div>
        </div>

        <div class="profile-actions">
            <#if user.role == "ADMIN">
                <a href="/admin" class="profile-button admin">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
            </#if>
            <a href="/statistics" class="profile-button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤</a>
            <button type="button" class="profile-button danger" onclick="document.getElementById('logout-form').submit();">
                –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
            </button>
        </div>
    </div>
</div>

<form id="logout-form" action="/logout" method="post" style="display: none;">
    <input type="hidden" id="csrf" name="${_csrf.parameterName}" value="${_csrf.token}"/>
</form>

<#include "modalWindowAbout.ftlh">
<#include "modalWindowEditAddress.ftlh">
<#include "modalWindowAddress.ftlh">
<#include "footer.ftlh">
<script src="/js/deleteAndUpdateAddress.js"></script>
<script src="/js/showModalAddress.js"></script>
</body>
</html>