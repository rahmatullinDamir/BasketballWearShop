<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å | Baller Merch</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<#include "header.ftlh">

<div class="admin-container">
    <div class="admin-header">
        <h1>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
        <#if message??>
            <div class="admin-message ${message?contains('—É—Å–ø–µ—à–Ω–æ')?then('success','error')}">
                ${message}
            </div>
        </#if>
    </div>

    <div class="admin-content">
        <!-- –°–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
        <div class="admin-section product-section">
            <div class="section-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <span class="section-icon">üèÄ</span>
            </div>

            <form method="post" action="/products/save" enctype="multipart/form-data" id="productForm" class="admin-form">
                <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
                
                <div class="form-group">
                    <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="productName" name="name" required/>
                </div>

                <div class="form-group">
                    <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="productDescription" name="description" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="productPrice">–¶–µ–Ω–∞:</label>
                    <input type="number" id="productPrice" step="0.01" name="price" required/>
                </div>

                <input type="hidden" name="sizesInput" id="sizesInput"/>

                <div class="form-group">
                    <label>–†–∞–∑–º–µ—Ä—ã:</label>
                    <div class="size-checkboxes">
                        <label class="size-checkbox">
                            <input type="checkbox" value="XS" class="size-checkbox-input">
                            <span class="size-checkbox-label">XS</span>
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="S" class="size-checkbox-input">
                            <span class="size-checkbox-label">S</span>
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="M" class="size-checkbox-input">
                            <span class="size-checkbox-label">M</span>
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="L" class="size-checkbox-input">
                            <span class="size-checkbox-label">L</span>
                        </label>
                        <label class="size-checkbox">
                            <input type="checkbox" value="XL" class="size-checkbox-input">
                            <span class="size-checkbox-label">XL</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="productImages">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="productImages" name="images" multiple accept="image/*" class="file-input"/>
                        <label for="productImages" class="file-input-label">
                            <span class="file-input-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</span>
                            <span class="file-input-button">–û–±–∑–æ—Ä</span>
                        </label>
                    </div>
                    <div id="imagePreviewContainer" class="image-preview-container"></div>
                </div>

                <button type="submit" id="productSubmitBtn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</button>
            </form>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–Ω–∞—á–∫–∞ -->
        <div class="admin-section badge-section">
            <div class="section-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –∑–Ω–∞—á–æ–∫</h2>
                <span class="section-icon">üèÜ</span>
            </div>

            <form method="post" action="/badges/save" enctype="multipart/form-data" id="badgeForm" class="admin-form">
                <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />

                <div class="form-group">
                    <label for="badgeName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="badgeName" name="name" required/>
                </div>

                <div class="form-group">
                    <label for="badgeDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="badgeDescription" name="description" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="badgePoints">–¢—Ä–µ–±—É–µ–º—ã–µ –±–∞–ª–ª—ã:</label>
                    <input type="number" id="badgePoints" name="requiredPoints" min="0" required/>
                </div>

                <div class="form-group">
                    <label for="iconInput">–ò–∫–æ–Ω–∫–∞:</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="iconInput" name="icon" accept="image/*" class="file-input"/>
                        <label for="iconInput" class="file-input-label">
                            <span class="file-input-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</span>
                            <span class="file-input-button">–û–±–∑–æ—Ä</span>
                        </label>
                    </div>
                    <div class="preview-container">
                        <img id="iconPreview" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∫–æ–Ω–∫–∏" style="display: none;"/>
                    </div>
                </div>

                <button type="submit" id="badgeSubmitBtn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–æ–∫</button>

            </form>
            <a href="/products/size-statistics">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–æ–≤.</a>
        </div>
    </div>
</div>

<#include "footer.ftlh">

<script>
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ç–æ–≤–∞—Ä–∞
document.getElementById('productForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const checkboxes = document.querySelectorAll('.size-checkbox-input:checked');
    const selectedSizes = Array.from(checkboxes).map(cb => cb.value);
    
    if (selectedSizes.length === 0) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑–º–µ—Ä.");
        return;
    }

    document.getElementById('sizesInput').value = selectedSizes.join(',');
    this.submit();
});

// –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–∞
document.getElementById('productImages').addEventListener('change', function(e) {
    const container = document.getElementById('imagePreviewContainer');
    container.innerHTML = '';
    
    Array.from(this.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.classList.add('image-preview');
            container.appendChild(img);
        }
        reader.readAsDataURL(file);
    });
});

// –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∫–æ–Ω–∫–∏ –∑–Ω–∞—á–∫–∞
document.getElementById('iconInput').addEventListener('change', function() {
    const file = this.files[0];
    const preview = document.getElementById('iconPreview');

    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        preview.src = '';
        preview.style.display = 'none';
    }
});
</script>

<script src="/js/form-protection.js"></script>
</body>
</html>